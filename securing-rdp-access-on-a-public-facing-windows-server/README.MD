# ğŸ›¡ï¸ Secure Remote Desktop Exposure â€“ Windows Server Lab

This project demonstrates how to **securely expose RDP (Remote Desktop Protocol)** on a **Windows Server 2019** machine while applying real-world cybersecurity hardening techniques. It also includes **advanced monitoring with Sysmon**, **Duo 2FA integration**, and a custom **RDP honeypot** to simulate attacker behavior.

---

## ğŸ”§ Lab Configuration

| Component             | Value                        |
|-----------------------|------------------------------|
| OS                    | Windows Server 2019          |
| Internal IP           | `192.168.1.139`              |
| RDP Real Access       | `PUBLIC_IP:50001 â†’ 3389`     |
| RDP Honeypot Access   | `PUBLIC_IP:3389 â†’ 33891`     |
| Remote Desktop        | âœ… Enabled                   |
| Network Level Auth    | âœ… Enabled                   |
| Admin Account         | ğŸ” Strong password           |

---

## ğŸ” Hardening Measures

### âœ… Step 1: Enable RDP Logon Auditing
```powershell
AuditPol /set /subcategory:"Logon" /success:enable /failure:enable
```

- `Event ID 4624` â†’ Successful logon  
- `LogonType 10` â†’ Remote Desktop logon

### âœ… Step 2: Restrict RDP by IP (Firewall)
```powershell
New-NetFirewallRule -DisplayName "Allow RDP from My IP" `
  -Direction Inbound -Protocol TCP -LocalPort 3389 `
  -RemoteAddress YOUR.PUBLIC.IP.HERE -Action Allow

Disable-NetFirewallRule -DisplayName "Remote Desktop - User Mode (TCP-In)"
```

### âœ… Step 3: Monitor Active RDP Sessions
```powershell
netstat -an | findstr :3389
```

### âœ… Step 4: Event Viewer Filter for RDP Logons
Paste this XML in **Event Viewer â†’ Filter â†’ XML tab**:
```xml
<QueryList>
  <Query Id="0" Path="Security">
    <Select Path="Security">
      *[System[(EventID=4624)]] and *[EventData[Data[@Name='LogonType']='10']]
    </Select>
  </Query>
</QueryList>
```

### âœ… Step 5: Export RDP Logons with PowerShell
```powershell
Get-WinEvent -FilterHashtable @{LogName='Security'; ID=4624} |
  Where-Object { $_.ToXml().ToString() -match '<LogonType>10</LogonType>' } |
  ForEach-Object {
    [xml]$xml = $_.ToXml()
    $ip = $xml.Event.EventData.Data | Where-Object {$_.Name -eq 'IpAddress'} | Select-Object -ExpandProperty '#text'
    "$($_.TimeCreated): $ip"
  } | Out-File "$env:USERPROFILE\Desktop\RDP_Logins.txt"
```

---

## ğŸ§ª Sysmon Integration

- [Sysmon](https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon) was installed to capture:
  - Logons
  - Process creations
  - File writes

### âœ… Install Command
```powershell
.\sysmon.exe -i
```

You can view logs under:  
ğŸ“ `Event Viewer â†’ Applications and Services Logs â†’ Microsoft â†’ Windows â†’ Sysmon`

---

## ğŸ” Duo 2FA Integration for RDP

- Duo Security was configured to enforce **two-factor authentication**
- RDP logon only succeeds **after a push confirmation via the Duo app**

ğŸ“Œ This prevents unauthorized access even if credentials are compromised.

**Learn more**: [https://duo.com/docs/rdp](https://duo.com/docs/rdp)

---

## ğŸª¤ RDP Honeypot Simulation

A lightweight **Python honeypot** was created to log unauthorized RDP scanning attempts.

### âœ… Configuration

| Role         | IP                 | Port    |
|--------------|--------------------|---------|
| Real RDP     | 192.168.1.139      | 3389    |
| Honeypot     | 192.168.1.139      | 33891   |

Port forwarding:
- **Public 3389** â†’ `192.168.1.139:33891` â†’ Honeypot
- **Public 50001** â†’ `192.168.1.139:3389` â†’ Real RDP

### âœ… Why Port 33891?

> The honeypot script was written in Python. It's just a simulation example, since we can't run two services on the same internal port.  
> Instead of using the same port, I configured the honeypot to listen on **port 33891**.  
> If you want to attract more attackers, you can run it on **port 3389** from a different internal IP address â€” but not on the same machine that's already using that port.

### âœ… Running the Honeypot
```bash
python rdphoney.py
```

### âœ… Example Output (`rdphoney_log.txt`)
```
2025-07-09 21:47:12 - Connection from: 102.34.55.18
```

---

## âš™ï¸ Optional: Run Honeypot as a Windows Service

Using [NSSM](https://nssm.cc/download):

```powershell
nssm install rdphoney
# Set path to python.exe
# Set arguments to rdphoney.py
Start-Service rdphoney
```

---

## ğŸ“ˆ Bonus: Analyze Honeypot IPs
```powershell
Get-Content rdphoney_log.txt | ForEach-Object {
  ($_ -split ' - ')[1]
} | Group-Object | Sort-Object Count -Descending
```

---

## ğŸ§  Purpose

This lab simulates real-world attack surfaces and demonstrates proper security hardening for remote access.  
It's ideal for:

- ğŸ” Blue team monitoring & log analysis
- ğŸ› ï¸ Building a cybersecurity home lab
- ğŸ“ Learning attacker behavior via honeypots

---

## ğŸ“ Files Included

- `rdphoney.py` â€“ Python RDP honeypot script
- `rdphoney_log.txt` â€“ attacker log file
- `README.md` â€“ full documentation

---

## ğŸ‘¤ Author

**ğŸ§  Caluian Ciprian**  
Cybersecurity enthusiast & practitioner  
Feel free to fork, improve, or contribute!

---
